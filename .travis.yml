sudo: true
dist: trusty
language: node_js
node_js:
  - "node"

jobs:
  include:
    - stage: "@vnhtml/lexer"
      install:
      - npm install --prefix packages/lexer
      script:
      - npm run-script compileBabel --prefix packages/lexer
      - npm run-script compileUglifyJs --prefix packages/lexer
      - cd packages/lexer
      - greenkeeper-lockfile-update
      - npm test
      - greenkeeper-lockfile-upload
      - cd ../..
      deploy:
        - provider: script
          script: echo $NPM_AUTH > ~/.npmrc && npm publish packages/lexer
          skip_cleanup: true
          on:
            tags: true
            branch: master
            repo: jameswilddev/vnhtml
    - stage: "@vnhtml/pretty-printer"
      install:
      - npm install --prefix packages/pretty-printer
      script:
      - npm run-script compileBabel --prefix packages/pretty-printer
      - npm run-script compileUglifyJs --prefix packages/pretty-printer
      - cd packages/pretty-printer
      - greenkeeper-lockfile-update
      - npm test
      - greenkeeper-lockfile-upload
      - cd ../..
      deploy:
        - provider: script
          script: echo $NPM_AUTH > ~/.npmrc && npm publish packages/pretty-printer
          skip_cleanup: true
          on:
            tags: true
            branch: master
            repo: jameswilddev/vnhtml
    - stage: "@vnhtml/parser"
      install:
      - npm install --prefix packages/parser
      script:
      - npm run-script compileBabel --prefix packages/parser
      - npm run-script compileUglifyJs --prefix packages/parser
      - cd packages/parser
      - greenkeeper-lockfile-update
      - npm test
      - greenkeeper-lockfile-upload
      - cd ../..
      deploy:
        - provider: script
          script: echo $NPM_AUTH > ~/.npmrc && npm publish packages/parser
          skip_cleanup: true
          on:
            tags: true
            branch: master
            repo: jameswilddev/vnhtml
    - stage: "@vnhtml/finite-state-machine-generator"
      install:
      - npm install --prefix packages/finite-state-machine-generator
      script:
      - npm run-script compileBabel --prefix packages/finite-state-machine-generator
      - npm run-script compileUglifyJs --prefix packages/finite-state-machine-generator
      - cd packages/finite-state-machine-generator
      - greenkeeper-lockfile-update
      - npm test
      - greenkeeper-lockfile-upload
      - cd ../..
      deploy:
        - provider: script
          script: echo $NPM_AUTH > ~/.npmrc && npm publish packages/finite-state-machine-generator
          skip_cleanup: true
          on:
            tags: true
            branch: master
            repo: jameswilddev/vnhtml
    - stage: "@vnhtml/collector"
      install:
      - npm install --prefix packages/collector
      script:
      - npm run-script compileBabel --prefix packages/collector
      - npm run-script compileUglifyJs --prefix packages/collector
      - cd packages/collector
      - greenkeeper-lockfile-update
      - npm test
      - greenkeeper-lockfile-upload
      - cd ../..
      deploy:
        - provider: script
          script: echo $NPM_AUTH > ~/.npmrc && npm publish packages/collector
          skip_cleanup: true
          on:
            tags: true
            branch: master
            repo: jameswilddev/vnhtml
    - stage: "@vnhtml/html-generator"
      install:
      - npm install --prefix packages/html-generator
      script:
      - npm run-script compileBabel --prefix packages/html-generator
      - npm run-script compileUglifyJs --prefix packages/html-generator
      - cd packages/html-generator
      - greenkeeper-lockfile-update
      - npm test
      - greenkeeper-lockfile-upload
      - cd ../..
      deploy:
        - provider: script
          script: echo $NPM_AUTH > ~/.npmrc && npm publish packages/html-generator
          skip_cleanup: true
          on:
            tags: true
            branch: master
            repo: jameswilddev/vnhtml
    - stage: "@vnhtml/cli"
      before_install:
      - sudo rm /etc/apt/sources.list.d/google-chrome.list
      - sudo dpkg --add-architecture i386
      - sudo apt-get update
      - sudo apt-get install libc6:i386 libstdc++6:i386
      install:
      - npm install --prefix packages/cli
      script:
      - npm run-script rimraf --prefix packages/cli
      - npm run-script mkdirp --prefix packages/cli
      - npm run-script compileBabel --prefix packages/cli
      - npm run-script compileUglifyJs --prefix packages/cli
      - npm run-script compilePkg --prefix packages/cli
      - npm run-script compileZipPkg --prefix packages/cli
      - npm run-script example --prefix packages/cli
      - cd packages/cli
      - greenkeeper-lockfile-update
      - npm test
      - greenkeeper-lockfile-upload
      - cd ../..
      deploy:
        - provider: releases
          api_key:
            secure: Uuexxmz+Q3usIL7Jh067QDCcom3QvlKg4y/6xeGjG7P3bRhAfHfZi35xkxXX+patqUNNziYJR+hCoN5rnfFK+PcJG+c0AYUOewD/KK9eGzHbSKpRsBaqghiH7H5Sk6CNEYb0acAlciXuihElUWgbaYvXWaHVpM2x7v0LLG8PmZrIZm4uHuAcdc2/oQrazshm5S4qFWJzoKfHz/8dvqc9b/J7o9bVlLYZ9KzEdftbNATSCXJFxkNdcrEKuJfP5+M3zE1QwoGhq/pxBRlV2jsfJiyNlTNqgqFfITpwaj4+8x5J5OacGHowGzJRgrr0GrGwXk+Mmn1qFoxyW6aMt5bbVu+WATYW5mRwJI6Et5eHOOU74bwIpkzQ/0Hg6WIqXAGgKSHGHNtERH2MurCE9u7h2+tALveS4qSg6vTRJ216yBtNht23Lmpkrh6e9nccgfmk8sYbVaSbVzI8vcpOdZVcuHZF3I88qpaIYVSttXKQPUx9CScAJ+Td0PqdHi5W7FNkWGFumI4r0IPguqeXY5v8yu2CW42gZ3+5mGs260RUE3ppSXZPtOxQ52H6/jJhlbGEsM5zK/uJrzjQIS3OcbljCTHMpX+BS0KlpEb/2TAlrVfJb+zg8cI/D1YAyYz/rHnfo4Rkj84Va9tN0pDcxBnnQci9qVCxKP1bpS7kLleM0u4=
          file_glob: true
          file: packages/cli/dist/*.zip
          skip_cleanup: true
          on:
            tags: true
            branch: master
            repo: jameswilddev/vnhtml
        - provider: script
          script: echo $NPM_AUTH > ~/.npmrc && npm publish packages/cli
          skip_cleanup: true
          on:
            tags: true
            branch: master
            repo: jameswilddev/vnhtml
env:
  global:
  - secure: iQu+DRNskHnYWuAvfzW9tZAVeusRaVTtvc7lFQkJ4AyLSO/NB+hnRUCkkhx7a6d1ZqiKMNXb8HizcWNSlpHWTYUB9jYgmMgLMdcmg3rjhT3sasz76RCozxLhFi4qKrQSjoiusMlBUzU32hpExiAmXoudhmAhYJyA1qdVBI/fQn0t8J21NDjw93QI9uqvFW3PV6sEkdIXajb5D5bTGffP1CcBZOYuYLIoST8CjvmmqbZTWsXLuFoBxYOmD5g8rHo6dZxE3zKiXHO7qcG7E4dSdrA+e3Pwca63JOOQVCTxc5ArR1ekLVA4EEBIigMcKfjyM/XNb6u40Ra4EGMimhDowN/qphOmdQb7hS9r6MlyEt7WLJIue6JW4BdJLQZXpS+xB2QE1+RcgdVnIhYx8ipd9r/xMV2As68+1pncn7ylnl6Ps1d5cjumFWtBjNO0qkJTapZmqWkd4RtfnGwe0/sh62DNfbMdok3/fTTyNIxeBu5XdeHkOSdfm5RXIjoj3rlHIVOPsuR8UaWNNFcmbvKyAWfKhd3drNFe14vfThUjKL8cY1POZqhPSp7hEhcnwf150eKWU7iy8aVSbR7I2yn6X8R9UfretLh/Lwfe1v0Iep6vuISR+6aNLV4cEEK+d37xY84M4pVQIQjeEoSw3e9MPSYex2bQWYxqs+Euc2RmwVU=
  - secure: L0K2YVdfddKMWPIBT58+elSPvtH4895YW8AKP/9eiG4FM89fdiuO48jHhVmD11xFAJpJhS4lMnQylMz1sgvbK50JlmNdVSzQpCPFjEhZmMuCI8CysWr1SlFLDsXdLcctzZH70T3ZxOn8teItZtI5SEuUZwORD1AtdljtEW6X3O22APjz+HHJxhQynWTX7eCeG/zoYsa9DAONpRNfVFDykPxin9XsZbXAcjKMk10A/N/bzhdbikZ4nDxQlBhbrO0EXSSKfTEr52ovwzLjxgXW2Nvig8g+uwatqBM/nDIpqipgQ4e0AiVgjXM3MIHHERnuChYTAyOJ16q88NVAMh3Pv1w171nxPKuVa9ztgdsZaQJPWytSNIcNxG2SY6f9hlVIfQi+d5849EfrbGDGf1WZ3eDuYG5dOn8BWKS9HVWe3UFtzoOysz5hnfrfkO4SDAlPDFKKP5K7ZIGkoG2rksbdFT6KWgVzOHxje/0AxgsC62mDtxNh5WK7bwtL+P7pHsI5iSxevJc0cgI1WUsTYQg+BeiJdmGFscZu4bK0OVSLZwSFgHmOrEO4X7XlQc/pXD6dTT3oYd1F/43HZ3fkn5oPlaM3liQW/f4zT31ifviM4b28QKZsdAhKndGfg1ijbyGUo9X0KZt0TL+y25x2JbmIhCk2E5X3/JnsKXD+T3Vc1h8=
